<!DOCTYPE html> 
<html> 
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
  <title>FOMC dotplot with D3 and Python</title>
  <!--[if lt IE 9]>
    <script src="https://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
  <![endif]-->

  <link rel="icon" href="favicon.png" />
  <link rel="apple-touch-icon-precomposed" href="apple-touch-icon.png" />

  <!--Bootstrap css -->
  <link rel="stylesheet" type="text/css" href="/assets/css/bootstrap.css"/>
  <!-- Sticky footer  -->
  <link rel="stylesheet" type="text/css" href="/assets/css/sticky-footer-navbar.css" />
  <!--Main Heather Theme css -->
  <link rel="stylesheet" type="text/css" href="/assets/css/heather.css" />
  <!-- CSS for publication list -->
  <link rel="stylesheet" href="/assets/css/publications.css" type="text/css" />
  <link rel="stylesheet" href="/assets/css/posts.css" type="text/css" />
   <!-- CSS for Google Web Fonts -->
  <link href='https://fonts.googleapis.com/css?family=Merriweather:400,700' rel='stylesheet' type='text/css'>
  <!-- Google code prettify -->
  <!--
  <script src="/assets/js/run_prettify.js?skin=desert"></script>
  -->
  <script src="/assets/js/prettify.js"></script>
  <link rel="stylesheet" type="text/css" href="/assets/css/prettify.css" />
  <!--
  <link rel="stylesheet" type="text/css" href="/assets/css/prettify.css" />
 -->
  <!-- Google Analytics -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-53244112-1', 'auto');
    ga('send', 'pageview');

  </script>

  <!-- Script to use LaTeX code with MathJax  -->
  <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- CSS for flaticons -->
  <link rel="stylesheet" type="text/css" href="/assets/css/flaticon.css"> 
  <!-- Script for jQuery library -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <!-- Script for bootstrap js library -->
  <script src="/assets/js/bootstrap.min.js" type="text/javascript"></script>
  <!-- meta data -->
  <meta name="author" content="Rubén Hernández-Murillo">
  <meta name="description" content="Research, Writings + Code">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="canonical" href="https://rubenhm.org/blog/2017/01/03/fomc-dotplot-with-d3-and-python/">
</head>
<body>

<header> 
  <!-- 	
  <h1 class="h2 m-0"><a href="https://rubenhm.org">rubenhm.org</a></h1>
  <p>Research, Writings + Code</p> 
  -->

  <!-- Bootstrap navbar -->
  <nav class = "navbar navbar-default navbar-fixed-top" role="navigation">
   <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
   	<div class = "navbar-header">
   		<button type="button"  class = "navbar-toggle" data-toggle = "collapse" data-target = "#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>  
   			<span class = "icon-bar"></span>
   			<span class = "icon-bar"></span>
   			<span class = "icon-bar"></span>
   		</button>
      <a class = "navbar-brand" href ="https://rubenhm.org">rubenhm.org</a>
    </div>
    
    <!-- Collect the nav links, forms, and other content for toggling -->
   	<div class ="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
 			<ul class ="nav navbar-nav navbar-right">
 				<li ><a href = "/">Home</a></li>
 				<li><a href = "/cv/">CV</a></li>
 				<li class ="dropdown">
 					<a href ="#" class = "dropdown-toggle" data-toggle ="dropdown">Research <b class="caret"></b></a>
 					<ul class = "dropdown-menu">
 						<li><a href="/pubs/journal_articles/">Journal articles</a></li>
 						<li><a href="/pubs/fed_pubs/">Fed Pubs</a></li>
 						<li><a href="/pubs/commentary/">Commentary</a></li>
 						<li><a href="/pubs/working_papers/">Working papers</a></li>
 					</ul>
 				</li> 
 				<li><a href="/blog/">Blog</a></li>
        <li><a href="/news/">News</a></li>
        <li><a href="/about/">About</a></li>
 			</ul>
   	</div><!-- /.navbar-collapse -->
 </div><!-- /.container-fluid -->
</nav>	

</header>  

<div class="container">
    <div class="visible-print"> <!--Header for print version -->
            <h1 class="text-left">https://rubenhm.org/blog/</h1>
            <p class="lead text-left">Research, Writings + Code</p>
            <hr>
    </div>
        
    <h1><em>Coding Annoyances</em></h1>
        <hr>    
    <h1>FOMC dotplot with D3 and Python</h1>
  
    <p class="small gray"><time datetime="Jan 3, 2017">03 January 2017 • Rubén Hernández-Murillo • </time></p>
    <hr>
    <article class="post">

        <p>The FOMC&#39;s <strong>dotplot</strong> is part of the Summary of Economic Projections (SEPs) released 4 times per year along with the policy decision statement on the 2nd, 4th, 6th, and 8th meetings of the FOMC. 
It shows the views of each of the FOMC&#39;s participants regarding the end-of-year level of the fed funds rate over the next few years and in the longer run.  </p>

<p>See page 3 of the <a href="https://www.federalreserve.gov/monetarypolicy/files/fomcprojtabl20161214.pdf">projection materials</a> from the December 2016 meeting.</p>

<p>Recreating this chart in Excel or some other program, such as Matlab or STATA, is not particularly straightforward.
I wanted to recreate the plot using <a href="https://d3js.org/">D3</a> but it wasn&#39;t clear how to prepare the source data to use D3&#39;s data-binding capabilities.</p>

<p>The <a href="https://www.federalreserve.gov/monetarypolicy/fomcprojtabl20161214.htm#figure2">html version</a> of the projection materials provides the following source data (also from the December 2016 meeting).</p>

<table><thead>
<tr>
<th>Midpoint of target range</th>
<th>2016</th>
<th>2017</th>
<th>2018</th>
<th>2019</th>
<th>Longer run</th>
</tr>
</thead><tbody>
<tr>
<td>0.125</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>0.250</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>0.375</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>0.500</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>0.625</td>
<td>17</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>0.750</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>0.875</td>
<td></td>
<td>2</td>
<td>1</td>
<td>1</td>
<td></td>
</tr>
<tr>
<td>1.000</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>1.125</td>
<td></td>
<td>4</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>1.250</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>1.375</td>
<td></td>
<td>6</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>1.500</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>1.625</td>
<td></td>
<td>3</td>
<td>1</td>
<td></td>
<td></td>
</tr>
<tr>
<td>1.750</td>
<td></td>
<td>1</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>1.875</td>
<td></td>
<td></td>
<td>5</td>
<td></td>
<td></td>
</tr>
<tr>
<td>2.000</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>2.125</td>
<td></td>
<td>1</td>
<td>3</td>
<td>1</td>
<td></td>
</tr>
<tr>
<td>2.250</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>2.375</td>
<td></td>
<td></td>
<td>2</td>
<td>2</td>
<td></td>
</tr>
<tr>
<td>2.500</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>1</td>
</tr>
<tr>
<td>2.625</td>
<td></td>
<td></td>
<td>2</td>
<td>3</td>
<td></td>
</tr>
<tr>
<td>2.750</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>6</td>
</tr>
<tr>
<td>2.875</td>
<td></td>
<td></td>
<td></td>
<td>2</td>
<td></td>
</tr>
<tr>
<td>3.000</td>
<td></td>
<td></td>
<td>1</td>
<td>2</td>
<td>7</td>
</tr>
<tr>
<td>3.125</td>
<td></td>
<td></td>
<td></td>
<td>2</td>
<td></td>
</tr>
<tr>
<td>3.250</td>
<td></td>
<td></td>
<td>1</td>
<td>2</td>
<td></td>
</tr>
<tr>
<td>3.375</td>
<td></td>
<td></td>
<td>1</td>
<td></td>
<td></td>
</tr>
<tr>
<td>3.500</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>1</td>
</tr>
<tr>
<td>3.625</td>
<td></td>
<td></td>
<td></td>
<td>1</td>
<td></td>
</tr>
<tr>
<td>3.750</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>1</td>
</tr>
<tr>
<td>3.875</td>
<td></td>
<td></td>
<td></td>
<td>1</td>
<td></td>
</tr>
</tbody></table>

<h2>The dotplot is a scatterplot</h2>

<p>This post from <a href="http://lenkiefer.com/2016/06/22/Make-a-dotplot">Len Kiefer&#39;s blog</a> made me realize I could treat the plot as a simple scatterplot. The key, then is to expand the count of participants at each rate level provided in the source table to be able to identify each of them with a circle.</p>

<p>Here is the final result using D3:</p>

<div class="map-container">
  <iframe src="/downloads/blog/2017-01-03-fomc-dotplot-with-d3-and-python/dotplot.html" frameborder="0" allowfullscreen marginwidth="0" marginheight="0" style="width:1200px;" scrolling="no">
  </iframe>
</div>

<div class="index-pop">
    <a target="_blank" title="Open map in a new window." href="/downloads/blog/2017-01-03-fomc-dotplot-with-d3-and-python/dotplot.html">Open<svg height="16" width="12"><path d="M11 10h1v3c0 0.55-0.45 1-1 1H1c-0.55 0-1-0.45-1-1V3c0-0.55 0.45-1 1-1h3v1H1v10h10V10zM6 2l2.25 2.25-3.25 3.25 1.5 1.5 3.25-3.25 2.25 2.25V2H6z"></path></svg></a>
</div>

<h2>Collect and prepare the source data with Python</h2>

<p>The simplest approach is to scrap the html code for the table using python and export the data to JSON format.</p>

<div class="highlight"><pre><code class="language-ipy" data-lang="ipy"><span class="c"># Download data for constructing the dotplot.</span>
<span class="c"># The source URL has the following structure:</span>
<span class="c"># https://www.federalreserve.gov/monetarypolicy/fomcprojtabl20161214.htm</span>
<span class="c"># (the file name seems to reference the date of the release)</span>


<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">bs4</span>
<span class="kn">import</span> <span class="nn">requests</span>


<span class="n">url</span> <span class="o">=</span> <span class="s">u&#39;https://www.federalreserve.gov/monetarypolicy/fomcprojtabl20161214.htm&#39;</span>


<span class="c"># Download file</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="c"># Check for errors</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">res</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;There was a problem: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">exc</span><span class="p">))</span>

<span class="c"># Save file to disk</span>
<span class="n">projectionFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;fomcprojtabl.htm&#39;</span><span class="p">,</span><span class="s">&#39;wb&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="mi">100000</span><span class="p">):</span>
    <span class="n">projectionFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
<span class="n">projectionFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="c"># Make the soup</span>
<span class="n">soup</span> <span class="o">=</span> <span class="n">bs4</span><span class="o">.</span><span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">,</span><span class="s">&#39;lxml&#39;</span><span class="p">)</span>

<span class="c"># Find the public tables</span>
<span class="n">tables</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s">&#39;table[class=&quot;pubtables&quot;]&#39;</span><span class="p">)</span>


<span class="c"># Parse table to generate a pandas DataFrame</span>
<span class="k">def</span> <span class="nf">parse_table</span><span class="p">(</span><span class="n">table</span><span class="p">):</span>
    <span class="c"># Parse rows</span>
    <span class="n">bdata</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">&#39;tr&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
        <span class="c"># find first column header</span>
        <span class="n">cols0</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">&#39;th&#39;</span><span class="p">)</span>
        <span class="n">cols0</span> <span class="o">=</span> <span class="p">[</span><span class="n">ele</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">cols0</span><span class="p">]</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">&#39;td&#39;</span><span class="p">)</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">ele</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">]</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">ele</span> <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">cols0</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="n">ele</span> <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">]</span>
        <span class="n">bdata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>
    <span class="c"># Convert to DataFrame</span>
    <span class="n">bdata</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;MidpointTargetRange&quot;</span> 
    <span class="n">bdata</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span> <span class="s">&quot;Longer Run&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">bdata</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">columns</span><span class="o">=</span><span class="n">bdata</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s">&quot;MidpointTargetRange&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">return</span>   <span class="n">df</span>


<span class="c"># Parse the last table only</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">parse_table</span><span class="p">(</span><span class="n">tables</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="c"># Expand count of participants to an array to identify</span>
<span class="c"># each dot individually</span>

<span class="n">dfsize</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span>
<span class="k">for</span> <span class="n">rows</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">dfsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">cols</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">dfsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="c"># print (df.ix[rows][cols])</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">rows</span><span class="p">][</span><span class="n">cols</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">count</span><span class="p">:</span>
            <span class="n">array</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">df</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">rows</span><span class="p">][</span><span class="n">cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span>

<span class="c"># Write data to json file resetting the index, per the following stackoverflow question:</span>
<span class="c"># http://stackoverflow.com/questions/28590663/pandas-dataframe-to-json-without-index</span>

<span class="n">df</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s">&quot;dotplot.json&quot;</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="s">&#39;records&#39;</span><span class="p">)</span></code></pre></div>

<p>Here is the <a href="/downloads/blog/2017-01-03-fomc-dotplot-with-d3-and-python/dotplot.json">resulting JSON file</a>.</p>

<h2>The javascript code</h2>

<p>Embedding the javascript in an html file, we have the following <a href="/downloads/blog/2017-01-03-fomc-dotplot-with-d3-and-python/dotplot.html">dotplot.html</a> file.</p>

<p>What&#39;s great is that when a new set of SEPs comes out, you need only to regenerate the updated json data file. The html file below need not be changed and the new dotplot will be updated.</p>

<p>The trickiest part was to figure out I had to use two scales for the x-axis: first an ordinal <strong>band scale</strong> for the different periods, and within each period, a <strong>point scale</strong> to organize the dots. </p>

<p>I also had to figure out how to center the dots in each period using the appropriate <code>translate</code> operation calculating where to start placing the dots along the point scale.</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;style&gt;</span>
<span class="nt">circle</span><span class="nc">.dots</span> <span class="p">{</span>
  <span class="n">fill</span><span class="o">:</span> <span class="m">#0860aa</span><span class="p">;</span>
  <span class="k">opacity</span><span class="o">:</span> <span class="m">1</span><span class="o">.</span><span class="m">0</span>
<span class="p">}</span>
<span class="nt">g</span><span class="nc">.tick</span> <span class="nt">line</span> <span class="p">{</span>
  <span class="n">stroke</span><span class="o">:</span> <span class="nb">black</span><span class="p">;</span>
  <span class="k">opacity</span><span class="o">:</span> <span class="m">0</span><span class="o">.</span><span class="m">5</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">g</span><span class="nc">.x.axis</span> <span class="nt">text</span> <span class="p">{</span>
  <span class="k">font-size</span><span class="o">:</span> <span class="m">18px</span><span class="p">;</span>
  <span class="n">fill</span><span class="o">:</span> <span class="nb">black</span><span class="p">;</span>
  <span class="k">font-family</span><span class="o">:</span> <span class="n">Helvetica</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">g</span><span class="nc">.y.axis</span> <span class="nt">text</span> <span class="p">{</span>
  <span class="k">font-size</span><span class="o">:</span> <span class="m">18px</span><span class="p">;</span>
  <span class="n">fill</span><span class="o">:</span> <span class="nb">black</span><span class="p">;</span>
  <span class="k">font-family</span><span class="o">:</span> <span class="n">Helvetica</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">g</span><span class="nc">.grid</span> <span class="nt">line</span> <span class="p">{</span>
  <span class="n">stroke</span><span class="o">:</span> <span class="n">grey</span><span class="p">;</span>
  <span class="n">stroke</span><span class="o">-</span><span class="k">opacity</span><span class="o">:</span> <span class="m">0</span><span class="o">.</span><span class="m">5</span><span class="p">;</span>
  <span class="n">shape</span><span class="o">-</span><span class="n">rendering</span><span class="o">:</span> <span class="n">crispEdges</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">g</span><span class="nc">.grid</span> <span class="nt">text</span><span class="nc">.y.label</span><span class="p">{</span>
  <span class="k">font-size</span><span class="o">:</span> <span class="m">18px</span><span class="p">;</span>
  <span class="n">fill</span><span class="o">:</span> <span class="nb">black</span><span class="p">;</span>
  <span class="k">font-family</span><span class="o">:</span> <span class="n">Helvetica</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">g</span><span class="nc">.grid</span> <span class="nt">path</span> <span class="p">{</span>
  <span class="n">stroke</span><span class="o">-</span><span class="k">width</span><span class="o">:</span> <span class="m">1px</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;dotplot&quot;</span><span class="nt">&gt;</span>

<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;//d3js.org/d3.v4.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script&gt;</span>
<span class="c1">// Reads data from a JSON file with the annual SEPs projections</span>

<span class="c1">// Auxiliary function</span>
<span class="c1">// Create array [1,2,...,N]</span>
<span class="c1">// http://stackoverflow.com/questions/3746725/create-a-javascript-array-containing-1-n</span>
<span class="kd">function</span> <span class="nx">nArray</span> <span class="p">(</span><span class="nx">N</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">dotArray</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">N</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">dotArray</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">dotArray</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">rArray</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">N</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">newArray</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">N</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">newArray</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">newArray</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">margin</span> <span class="o">=</span> <span class="p">{</span><span class="nx">top</span><span class="o">:</span> <span class="mi">50</span><span class="p">,</span> <span class="nx">right</span><span class="o">:</span> <span class="mi">200</span><span class="p">,</span> <span class="nx">bottom</span><span class="o">:</span> <span class="mi">50</span><span class="p">,</span> <span class="nx">left</span><span class="o">:</span> <span class="mi">50</span><span class="p">};</span>
<span class="kd">var</span> <span class="nx">outerWidth</span> <span class="o">=</span> <span class="mi">1210</span> <span class="p">;</span>
<span class="kd">var</span> <span class="nx">outerHeight</span> <span class="o">=</span> <span class="mi">600</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">innerWidth</span> <span class="o">=</span> <span class="nx">outerWidth</span> <span class="o">-</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">left</span> <span class="o">-</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">right</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">innerHeight</span> <span class="o">=</span> <span class="nx">outerHeight</span> <span class="o">-</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">top</span> <span class="o">-</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">bottom</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">topYAxisPadding</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">plotDotPlot</span> <span class="o">=</span> <span class="p">{};</span>
<span class="nx">plotDotPlot</span><span class="p">.</span><span class="nx">svg</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="c1">// Define SVG</span>
<span class="nx">plotDotPlot</span><span class="p">.</span><span class="nx">svg</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">&quot;#dotplot&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;svg&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="nx">outerWidth</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="nx">outerHeight</span><span class="p">);</span>

<span class="c1">// Read data</span>
<span class="nx">d3</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="s1">&#39;dotplot.json&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>


      <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">pt</span><span class="p">.</span><span class="nx">displayError</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="c1">// Examine data</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>

      <span class="c1">// Read years</span>
      <span class="kd">var</span> <span class="nx">years</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">years</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">index</span><span class="p">)</span>
      <span class="p">}</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">years</span><span class="p">)</span>

      <span class="c1">// Read rates</span>
      <span class="c1">// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys</span>
      <span class="kd">var</span> <span class="nx">dataCols</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
      <span class="c1">// Remove index</span>
      <span class="nx">dataCols</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
      <span class="c1">// Interest Rate Scale range provided in SEPs</span>
      <span class="c1">// make numeric</span>
      <span class="kd">var</span> <span class="nx">numScale</span> <span class="o">=</span> <span class="nx">dataCols</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">+</span><span class="nx">d</span><span class="p">;</span>
      <span class="p">})</span>

      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">dataCols</span><span class="p">)</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">numScale</span><span class="p">)</span>

      <span class="c1">// Calculate max number of dots for the same rate</span>
      <span class="kd">var</span> <span class="nx">maxDots</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
       <span class="o">|</span>   <span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
          <span class="c1">// Generate array of values</span>
          <span class="c1">// console.log(d)</span>
          <span class="kd">var</span> <span class="nx">dvalues</span> <span class="o">=</span> <span class="p">[];</span>
          <span class="kd">var</span> <span class="nx">ic</span><span class="p">;</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">ic</span> <span class="k">in</span> <span class="nx">dataCols</span><span class="p">)</span> <span class="p">{</span>
              <span class="kd">var</span> <span class="nx">col</span> <span class="o">=</span> <span class="nx">dataCols</span><span class="p">[</span><span class="nx">ic</span><span class="p">]</span>
              <span class="c1">// if (col != &quot;Period&quot;) {</span>
                <span class="nx">dvalues</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">d</span><span class="p">[</span><span class="nx">col</span><span class="p">].</span><span class="nx">length</span><span class="p">)</span>
              <span class="c1">// }</span>
          <span class="p">}</span>
          <span class="c1">// console.log(dvalues)</span>
          <span class="c1">// Spread operator (...) to calculate max of an array:</span>
          <span class="c1">// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/max</span>
          <span class="c1">// console.log(Math.max(...dvalues)) </span>
          <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(...</span><span class="nx">dvalues</span><span class="p">);</span>
        <span class="p">});</span>

      <span class="c1">// console.log(maxDots)</span>

      <span class="c1">// Generate array of serials</span>
      <span class="c1">// dotArray = [1, 2, ..., N]</span>
      <span class="kd">var</span> <span class="nx">dotArray</span> <span class="o">=</span> <span class="nx">nArray</span><span class="p">(</span><span class="nx">maxDots</span><span class="p">)</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">dotArray</span><span class="p">)</span>

      <span class="c1">// Scales and Axes</span>
      <span class="c1">// Ordinal Band scale for X. Keep as string (don&#39;t use +d.index)</span>
      <span class="nx">plotDotPlot</span><span class="p">.</span><span class="nx">x0</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">scaleBand</span><span class="p">()</span>
             <span class="p">.</span><span class="nx">domain</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">index</span><span class="p">;</span> <span class="p">}))</span>
             <span class="p">.</span><span class="nx">rangeRound</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="nx">innerWidth</span><span class="p">])</span>
             <span class="p">.</span><span class="nx">padding</span><span class="p">(</span><span class="mf">0.1</span><span class="p">);</span>

      <span class="c1">// Ordinal point scale to arrange dots in each band</span>
      <span class="c1">// domain is the largest number of dots in any given band</span>
      <span class="c1">// range is the bandwidth of the band</span>
      <span class="nx">plotDotPlot</span><span class="p">.</span><span class="nx">x1</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">scalePoint</span><span class="p">()</span>
              <span class="p">.</span><span class="nx">domain</span><span class="p">(</span><span class="nx">dotArray</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">range</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nx">plotDotPlot</span><span class="p">.</span><span class="nx">x0</span><span class="p">.</span><span class="nx">bandwidth</span><span class="p">()])</span>

      <span class="c1">// Y linear scale with hardcoded bounds</span>
      <span class="nx">plotDotPlot</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">scaleLinear</span><span class="p">()</span>
              <span class="c1">// .domain(d3.extent(numScale)) // automatic</span>
              <span class="p">.</span><span class="nx">domain</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>                 <span class="c1">// harcoded</span>
              <span class="p">.</span><span class="nx">range</span><span class="p">([</span><span class="nx">innerHeight</span><span class="p">,</span><span class="mi">0</span><span class="p">]);</span>

      <span class="c1">// Axes generators</span>
      <span class="nx">plotDotPlot</span><span class="p">.</span><span class="nx">xAxis</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">axisBottom</span><span class="p">(</span><span class="nx">plotDotPlot</span><span class="p">.</span><span class="nx">x0</span><span class="p">);</span>
      <span class="nx">plotDotPlot</span><span class="p">.</span><span class="nx">yAxis</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">axisRight</span><span class="p">(</span><span class="nx">plotDotPlot</span><span class="p">.</span><span class="nx">y</span><span class="p">).</span><span class="nx">ticks</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

      <span class="c1">// Gridlines: https://bl.ocks.org/d3noob/c506ac45617cf9ed39337f99f8511218</span>
      <span class="c1">// gridlines in x axis function</span>
      <span class="kd">function</span> <span class="nx">make_x_gridlines</span><span class="p">()</span> <span class="p">{</span>   
          <span class="k">return</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">axisBottom</span><span class="p">(</span><span class="nx">plotDotPlot</span><span class="p">.</span><span class="nx">x0</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">ticks</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
      <span class="p">}</span>

      <span class="c1">// gridlines in y axis function</span>
      <span class="kd">function</span> <span class="nx">make_y_gridlines</span><span class="p">()</span> <span class="p">{</span>   
          <span class="k">return</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">axisLeft</span><span class="p">(</span><span class="nx">plotDotPlot</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">ticks</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
      <span class="p">}</span>

      <span class="c1">// Add svg</span>
      <span class="nx">plotDotPlot</span><span class="p">.</span><span class="nx">chartGroup</span> <span class="o">=</span> <span class="nx">plotDotPlot</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;transform&quot;</span><span class="p">,</span><span class="s2">&quot;translate(&quot;</span><span class="o">+</span><span class="nx">margin</span><span class="p">.</span><span class="nx">left</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nx">margin</span><span class="p">.</span><span class="nx">top</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">);</span>

      <span class="nx">plotDotPlot</span><span class="p">.</span><span class="nx">chartGroup</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="s2">&quot;x axis&quot;</span><span class="p">)</span>
               <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;transform&quot;</span><span class="p">,</span> <span class="s2">&quot;translate(0,&quot;</span><span class="o">+</span><span class="nx">innerHeight</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
               <span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">plotDotPlot</span><span class="p">.</span><span class="nx">xAxis</span><span class="p">);</span>
               

      <span class="nx">plotDotPlot</span><span class="p">.</span><span class="nx">chartGroup</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="s2">&quot;grid&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;transform&quot;</span><span class="p">,</span> <span class="s2">&quot;translate(0,&quot;</span> <span class="o">+</span> <span class="nx">innerHeight</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">make_x_gridlines</span><span class="p">()</span>
                  <span class="p">.</span><span class="nx">tickSize</span><span class="p">(</span><span class="o">-</span><span class="nx">innerHeight</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">tickFormat</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="p">);</span>

      <span class="nx">plotDotPlot</span><span class="p">.</span><span class="nx">chartGroup</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="s2">&quot;y axis&quot;</span><span class="p">)</span>
               <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;transform&quot;</span><span class="p">,</span> <span class="s2">&quot;translate(&quot;</span><span class="o">+</span><span class="nx">innerWidth</span><span class="o">+</span><span class="s2">&quot;,0)&quot;</span><span class="p">)</span>
               <span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">plotDotPlot</span><span class="p">.</span><span class="nx">yAxis</span><span class="p">);</span>

      <span class="nx">plotDotPlot</span><span class="p">.</span><span class="nx">chartGroup</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">)</span>
               <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="s2">&quot;grid&quot;</span><span class="p">)</span>
               <span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">make_y_gridlines</span><span class="p">()</span>
                  <span class="p">.</span><span class="nx">tickSize</span><span class="p">(</span><span class="o">-</span><span class="nx">innerWidth</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">tickFormat</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="p">);</span>

      <span class="c1">// Add labels to axes</span>
      <span class="nx">plotDotPlot</span><span class="p">.</span><span class="nx">chartGroup</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;y label&quot;</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;text-anchor&quot;</span><span class="p">,</span><span class="s2">&quot;end&quot;</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="nx">innerWidth</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="o">-</span><span class="nx">topYAxisPadding</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;Percent, end of year&quot;</span><span class="p">)</span>


      <span class="c1">// Add circles</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">rows</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">rows</span> <span class="o">&lt;</span> <span class="nx">years</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">rows</span><span class="o">++</span><span class="p">)</span>  <span class="p">{</span>

          <span class="kd">var</span> <span class="nx">rateData</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="nx">rows</span><span class="p">]</span>
          <span class="nx">plotDotPlot</span><span class="p">.</span><span class="nx">chartGroup</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">&quot;fomc &quot;</span><span class="o">+</span><span class="s2">&quot;M&quot;</span><span class="o">+</span><span class="nx">years</span><span class="p">[</span><span class="nx">rows</span><span class="p">])</span>
                <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">rateData</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">enter</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="s2">&quot;fomc &quot;</span><span class="o">+</span><span class="s2">&quot;M&quot;</span><span class="o">+</span><span class="nx">years</span><span class="p">[</span><span class="nx">rows</span><span class="p">])</span>

          <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">cols</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">cols</span><span class="o">&lt;</span> <span class="nx">dataCols</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">cols</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
               <span class="c1">// Calculate length of dot array</span>
               <span class="kd">var</span> <span class="nx">lenDotArray</span> <span class="o">=</span> <span class="nx">rateData</span><span class="p">[</span><span class="nx">dataCols</span><span class="p">[</span><span class="nx">cols</span><span class="p">]].</span><span class="nx">length</span>
               <span class="kd">var</span> <span class="nx">mclass</span> <span class="o">=</span> <span class="s2">&quot;dots &quot;</span><span class="o">+</span><span class="s2">&quot;M&quot;</span><span class="o">+</span> <span class="nx">rows</span><span class="o">+</span><span class="s2">&quot; N&quot;</span><span class="o">+</span><span class="nx">cols</span>
               <span class="nx">plotDotPlot</span><span class="p">.</span><span class="nx">chartGroup</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="nx">mclass</span><span class="p">)</span>
                     <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="nx">d</span><span class="o">=</span><span class="nx">rateData</span><span class="p">[</span><span class="nx">dataCols</span><span class="p">[</span><span class="nx">cols</span><span class="p">]];</span>
                     <span class="p">})</span>
                     <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
                     <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;circle&quot;</span><span class="p">)</span>
                     <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="nx">mclass</span><span class="p">)</span>
                     <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;transform&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
                        <span class="c1">// Center dots in each band:</span>
                        <span class="c1">// Caculate translate distance as half of diff with bandwidth</span>
                        <span class="kd">var</span> <span class="nx">transDim</span> <span class="o">=</span> <span class="nx">plotDotPlot</span><span class="p">.</span><span class="nx">x0</span><span class="p">(</span><span class="nx">years</span><span class="p">[</span><span class="nx">rows</span><span class="p">])</span><span class="o">+</span><span class="p">(</span><span class="nx">plotDotPlot</span><span class="p">.</span><span class="nx">x0</span><span class="p">.</span><span class="nx">bandwidth</span><span class="p">()</span><span class="o">-</span><span class="nx">plotDotPlot</span><span class="p">.</span><span class="nx">x1</span><span class="p">(</span><span class="nx">lenDotArray</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
                        <span class="k">return</span> <span class="s2">&quot;translate(&quot;</span><span class="o">+</span><span class="nx">transDim</span><span class="o">+</span><span class="s2">&quot;,0)&quot;</span><span class="p">;</span> 
                      <span class="p">})</span>
                     <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;cx&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> 
                        <span class="k">return</span> <span class="nx">plotDotPlot</span><span class="p">.</span><span class="nx">x1</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
                     <span class="p">})</span>
                     <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;cy&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
                           <span class="k">return</span>  <span class="nx">plotDotPlot</span><span class="p">.</span><span class="nx">y</span><span class="p">(</span><span class="o">+</span><span class="nx">dataCols</span><span class="p">[</span><span class="nx">cols</span><span class="p">]);</span> <span class="p">})</span>
                     <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> 
                            <span class="k">if</span> <span class="p">(</span><span class="nx">d</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">){</span>
                              <span class="k">return</span> <span class="mi">5</span><span class="p">;</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                              <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
                            <span class="p">}</span>
                      <span class="p">})</span>
          <span class="p">}</span>
      <span class="p">}</span>

<span class="p">})</span>
<span class="nt">&lt;/script&gt;</span></code></pre></div>


    </article>
    <hr>
        <div class="row hidden-print">
        <div class="col-md-6">
            <p>If you enjoyed this article, consider sharing it.</p>
            <p><a href="https://twitter.com/intent/tweet?text=FOMC dotplot with D3 and Python&url=https://rubenhm.org/blog/2017/01/03/fomc-dotplot-with-d3-and-python/&via=rubenhm_org" title="Share link on Twitter"><span class="flaticon-social19"></span></a>
            <a  href="https://plus.google.com/share?url=https://rubenhm.org/blog/2017/01/03/fomc-dotplot-with-d3-and-python/" title="Share link on G+"><span class="flaticon-google23"></span></a>
            <a href="https://www.facebook.com/sharer/sharer.php?u=https://rubenhm.org/blog/2017/01/03/fomc-dotplot-with-d3-and-python/" title="Share link on FB"><span class="flaticon-facebook29"></span></a>
            <a href="mailto:?Subject=FOMC dotplot with D3 and Python&amp;Body=https://rubenhm.org/blog/2017/01/03/fomc-dotplot-with-d3-and-python/" title="Share link by email"><span class="flaticon-opened4"></span></a>
            <a href="/downloads/blog/2017-01-03-fomc-dotplot-with-d3-and-python/2017-01-03-fomc-dotplot-with-d3-and-python.pdf" title="Download PDF"><span class="flaticon-adobe21"></span></a></p>
            
            <!-- <a><span class="flaticon-printer70"></span></a> -->
        </div>
        <div class="col-md-6">
            <p>Follow for updates.</p>
            <p><a href="/feed.xml" title="Subscribe to Blog Feed"><span class="flaticon-rss8"></span></a> 
            <a href="https://twitter.com/intent/follow?screen_name=rubenhm_org" title="Follow on Twitter"><span class="flaticon-social19"></span></a></p>
        </div>
    </div>
    <hr>

    <div class="visible-print">
            <p><small>Follow for updates.</small></p>
            <p><a href="https://rubenhm.org/feed.xml" title="Subscribe to Blog Feed"><span class="flaticon-rss8"></span></a> 
            <span class="flaticon-social19"></span> @rubenhm_org</a></p>
            <hr>
    </div>
    <div class="hidden-print">
        <h2>Comments section</h2>
        <div class="alert alert-info" role="alert"> 
        <p><span class="flaticon-info12"></span> <strong>Rules:</strong> This forum is intended for a collegial discussion on economics and research tools. <br/>
            All comments will be initially withheld and promptly moderated prior to posting. Comments will be posted if they are done in a respectful and courteous manner.  
            We reserve the right to remove or not publish inappropriate comments.</p>
        </div>
   
        <hr>
        <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'rubenhm'; // required: replace example with your forum shortnam
        var disqus_identifier = '/blog/2017/01/03/fomc-dotplot-with-d3-and-python/';
        var disqus_url = 'https://rubenhm.org/blog/2017/01/03/fomc-dotplot-with-d3-and-python/';

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">   comments powered by Disqus.</a></noscript>
    <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
    </div>
</div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'rubenhm'; // required: replace example with your forum shortname
    var disqus_identifier = '/blog/2017/01/03/fomc-dotplot-with-d3-and-python/';
    var disqus_url = 'https://rubenhm.org/blog/2017/01/03/fomc-dotplot-with-d3-and-python/';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
    
<!-- Script to fix <pre> tag to highlight code -->
<script type="text/javascript">
    $(document).ready(function(){
    $("pre").addClass("prettyprint linenums");
     prettyPrint();
});
</script>
</body>
</html>
